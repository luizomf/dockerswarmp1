<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>
      Docker Swarm em 3 VPS (Produ√ß√£o Real) - Ot√°vio Miranda + Hostinger
    </title>
    <link rel="stylesheet" href="/style.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="icon"
      type="image/png"
      href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAMAAABg3Am1AAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAlVQTFRFAAAAKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzUKWzULW/VLW7VNHTWaJfhqcTuz9713+n50N/2p8PtbJrhOHbXKWzUbJri4uv5/v7/////5+/6cJ3iKWzUT4bcwNTzzd31SoPbKWzUapjh8/f97/T8Y5TgToXb5e36ZJXgPHnY4er58fb8UYfcKWzUn73s6/H7r8jvnr3st87x9fj92+b4LG7VMXLW8PX8+vz+hqznNXXWl7fqlbbqKmzUKWzUc5/j9vn9daDjXpHf+fv+WIzdsMnvq8Xus8vw6fD7/P3+V4zdK23UX5HfYZLfK27UVInd+/z+TYTbKWzUcZ3j5+76Z5bhbpziNXTWzNz1OXfXxNfz3Of4Km3UdKDj/v//fablvNLyMHHWKWzUgKjm/f3/4ev5L3DVfKXlfqblMnLW5Oz6yNn0+vv+U4ncRoDa9/n90d/2RX/aKWzU1eL32ub4TYXb9/r+MXHW1OL2O3jYb5zi9/r9b5ziia7nS4Tb/f7/SYLb5O36havncZ7jg6rmQn3Z////krTpo8DtRH7Z0+H2////7fP7XI/e////Q37ZWo7eRYDa2OT3////PnrY4+z5cZ7i////////R4Ha////jLDo////////wNTy////////WIze////////////e6Tl////////PnvY////////xdfz////////////NnXXpMHt////ganm////W47e////////OnjXo5SoAQAAAMd0Uk5TAAEpZ5zA4fT8ABdf1P8jk+oUlOwhw2P1bv//////////////Iv///////8L/////E///////////////6//////////////////////T/////////////////////////53////////////////////g/////////////////////f////////////T//+D////////A/////5z//2f/////Kf///9MB/1//6xf/kwD/7CKU/8IT//Uh//xjbv//w/8U/+oj1GMYmn4AAANFSURBVHichVZ7TM1RHP9+bt1bt7hEqmFsRObZ/JMthJk2C7toLVmEyIx55A+PIYaFpsdmRjHltSavLksmbNj6pxWWodnUvG5tWeimW/383r/ze1x9/jjnfB+f8/iec77ngAyADOJkGO06ySm6shAovkAEpx3oN45IQRzn91kSIoBek7sAB8d1WhAi0WPpLiCU6zASMArdAf2Jwrh2TkdA9E/7f/yJ/MN/cAwB0Zy5/yH4xY4BiSERoroM/bvE+AqFVx3D5VUJsb8M/ceo2wG0qWP0d8iEiNGtOvfx8DOSA5/k1jh7o0hwOv06/1hDvMLxXm7ZfT6B4LLr9mvKb+PxcaFZHiyihSc4HQOsdRo6yYgReC01bL0+UNjsJtYY3y6UUUKAvqrKMagX61kN3aBwG+s/B63Cqpt+E83Fd3UxE/FcrAf+ACnPWMLCD0RxeCIJiweU5U5FrVgv8MAWrptu8luiGTWKFBmitGZ2S0P8QVAY658wsoni4aFl/BLuErnlufO7NrNKrLuRdYslpL4iSqzporS2GMdNovT+l4olCdeEygd7KDvApKdEi1BO6/B4yWVe/ujUJosyvuzBrlKGkI0HRCk4T0PXopwP1Dbc0Ywrr3QRbUKIQ9UkTfDyh4VWoUjR7EQl010aCqgXeWdURdYLKe5r3nkUTS27QMpAfi5DSJleIbdcLik4+/qu6wiU2DNZm1Lm2CuqYf1xsTp4SZ+kiDZAW/RhbfWLWsVdOvLNQ0ZsVsN6tJo/azkFufzFrOz8LGhOFttM/rQdwXKk84tpdCrelCuWhFELzpr9abdyNHIavuxBXbVq2NYSV2XhT3uVw1d0NSp5B2spwUkrwn7leJ8DcvSmDFud2f8Q1AuUUG80XjxlTm55aaYryqDsdqNBcwyrTUmAwcZ5BwyaE3Cb0wyDivJmnZyP5VaJTMOQkFCdfLrPLabKeH+rNYFu5LJSAZYGSsYKKs8yXRUimQKmexmZK7TNLMFiov8+KAK0G1Ro96ZrhIBP1r0L8laU2CT/QR/FM9KRLQxuTycdIdCze3+rUJ7/m6woBnvYPVv4/bINm08WBMuvw8PsUm+0102WBKvPyaO2oCA3qzCmhUG/P/8ANUr16JyCiaoAAAAASUVORK5CYII="
    />
  </head>
  <body>
    <div class="bg-fixed">
      <div class="nebula"></div>
      <div class="stars-sm"></div>
      <div class="stars-md"></div>
      <div class="shooting-stars">
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>

    <main class="container">
      <!-- HERO. -->
      <section class="hero panel">
        <span class="tag">Docker Swarm Cluster</span>
        <h1>Docker Swarm em <br />3 VPS (Produ√ß√£o Real)</h1>
        <p class="subtitle">WireGuard + Traefik + GHCR + FastAPI + Postgres.</p>

        <div class="actions">
          <a href="#test" class="btn btn-primary">Testar a API agora</a>
          <a href="#about" class="btn btn-secondary">Veja como foi feito</a>
        </div>
      </section>

      <!-- SPONSOR -->
      <section class="hostinger-card">
        <div class="sponsor-label">Patrocinado por Hostinger üíú</div>
        <div class="coupon-area">
          <span class="coupon-text"
            >CUPOM: <strong id="coupon-code">OTAVIOMIRANDA</strong></span
          >
          <button
            class="btn-copy"
            onclick="copyCoupon(this)"
            aria-label="Copiar cupom"
          >
            <svg
              width="20"
              height="20"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
              <path
                d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"
              ></path>
            </svg>
            Copiar
          </button>
        </div>
        <a
          href="https://www.hostinger.com/otaviomiranda"
          target="_blank"
          rel="noopener noreferrer"
          class="btn btn-hostinger"
        >
          Apoie o canal e pegue seu desconto (10% OFF)
        </a>
        <p class="disclosure">
          Este patroc√≠nio ajuda a manter meus v√≠deos no ar.
        </p>
      </section>

      <!-- STATS -->
      <section class="panel stats-panel">
        <div class="stat-box">
          <span class="stat-label">Visitas Hoje (√∫nicas)</span>
          <span class="stat-value" id="visit-count">...</span>
        </div>
        <div class="stat-box">
          <span class="stat-label">Container</span>
          <span class="stat-value" id="visit-host">...</span>
        </div>
      </section>

      <!-- CONTENT GRID -->
      <section id="about" class="grid">
        <div class="card">
          <h3>Infraestrutura</h3>
          <p>
            Cluster com KVM2, KVM4 e KVM8 interligados via
            <strong>WireGuard</strong> (rede privada 10.100.0.0/24).
          </p>
        </div>
        <div class="card">
          <h3>Roteamento</h3>
          <p>
            <strong>Traefik</strong> recebe tudo na porta 443 e distribui para
            os servi√ßos.
          </p>
        </div>
        <div class="card">
          <h3>CI/CD & Imagens</h3>
          <p>
            Imagens buildadas no GitHub Actions e hospedadas no
            <strong>GHCR</strong>. Deploy via Webhook.
          </p>
        </div>
        <div class="card">
          <h3>Banco de Dados</h3>
          <p>
            <strong>Postgres 18</strong> rodando como servi√ßo stateful, fixado
            no n√≥ mais robusto.
          </p>
        </div>
        <div class="card">
          <h3>Backend</h3>
          <p>
            API em <strong>FastAPI</strong> escal√°vel, servindo dados de acesso
            em tempo real.
          </p>
        </div>
        <div class="card">
          <h3>Frontend</h3>
          <p>
            P√°gina est√°tica servida por <strong>Nginx</strong>, ultra leve e
            perform√°tica.
          </p>
        </div>
      </section>

      <!-- ARCHITECTURE -->
      <section class="panel architecture">
        <h2>Arquitetura Simplificada</h2>
        <div class="diagram">
          <div class="diagram-row">
            <div class="box internet">Internet</div>
          </div>
          <div class="diagram-arrow">‚Üì :443</div>
          <div class="diagram-row">
            <div class="box traefik">Traefik (Load Balancer)</div>
          </div>
          <div class="diagram-arrow">‚Üô &nbsp; ‚Üò</div>
          <div class="diagram-row mixed">
            <div class="box app">Frontend<br />(Nginx)</div>
            <div class="box app">API<br />(FastAPI)</div>
          </div>
          <div class="diagram-arrow align-right">‚Üì</div>
          <div class="diagram-row align-right">
            <div class="box db">Postgres<br />(Stateful)</div>
          </div>
          <p class="diagram-note">* Todos os n√≥s conectados via WireGuard</p>
        </div>
      </section>

      <!-- TEST -->
      <section id="test" class="panel test-section">
        <h2>Teste R√°pido</h2>
        <p>Execute no seu terminal para ver a API respondendo:</p>
        <div class="code-block">
          <code>curl -fsS https://app.myswarm.cloud/api/visit</code>
          <button
            class="btn-copy-code"
            onclick="
              copyToClipboard(
                'curl -fsS https://app.myswarm.cloud/api/visit',
                this,
              )
            "
          >
            Copiar
          </button>
        </div>
        <p>Ou acesse a home via curl:</p>
        <div class="code-block">
          <code>curl -fsS https://app.myswarm.cloud/</code>
          <button
            class="btn-copy-code"
            onclick="
              copyToClipboard('curl -fsS https://app.myswarm.cloud/', this)
            "
          >
            Copiar
          </button>
        </div>
      </section>

      <!-- FOOTER -->
      <footer>
        <p>
          <strong>Repo:</strong>
          <span class="muted">(link na descri√ß√£o do v√≠deo)</span>
        </p>
        <p>
          <strong>Stack:</strong> Swarm ‚Ä¢ Traefik ‚Ä¢ FastAPI ‚Ä¢ Postgres ‚Ä¢ Nginx
        </p>
      </footer>
    </main>

    <div
      id="toast"
      class="toast"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <script>
      // Stats Fetch
      fetch('/api/visit')
        .then(res => res.json())
        .then(data => {
          const el = document.getElementById('visit-count');
          if (el && data && typeof data.unique_visits === 'number') {
            el.textContent = data.unique_visits.toString();
          }

          const hostEl = document.getElementById('visit-host');
          if (hostEl && data && typeof data.hostname === 'string') {
            hostEl.textContent = data.hostname;
          }
        })
        .catch(() => {
          const el = document.getElementById('visit-count');
          if (el) el.textContent = 'Offline';

          const hostEl = document.getElementById('visit-host');
          if (hostEl) hostEl.textContent = 'Offline';
        });

      function showToast(message) {
        const toast = document.getElementById('toast');
        if (!toast) return;

        toast.textContent = message;
        toast.classList.add('toast--show');
        window.clearTimeout(toast.__timerId);
        toast.__timerId = window.setTimeout(() => {
          toast.classList.remove('toast--show');
        }, 1800);
      }

      function copyText(text) {
        if (navigator.clipboard && window.isSecureContext) {
          return navigator.clipboard.writeText(text);
        }

        return new Promise((resolve, reject) => {
          try {
            const ta = document.createElement('textarea');
            ta.value = text;
            ta.setAttribute('readonly', 'true');
            ta.style.position = 'fixed';
            ta.style.left = '-9999px';
            ta.style.top = '0';
            document.body.appendChild(ta);
            ta.focus();
            ta.select();
            const ok = document.execCommand('copy');
            document.body.removeChild(ta);
            ok ? resolve() : reject(new Error('copy failed'));
          } catch (err) {
            reject(err);
          }
        });
      }

      function markCopied(button) {
        if (!button) return;
        const oldText = button.textContent;
        button.textContent = 'Copiado!';
        button.disabled = true;
        window.setTimeout(() => {
          button.textContent = oldText;
          button.disabled = false;
        }, 1200);
      }

      // Coupon Copy
      function copyCoupon(button) {
        const couponEl = document.getElementById('coupon-code');
        const coupon = couponEl ? couponEl.innerText : 'OTAVIOMIRANDA';

        copyText(coupon)
          .then(() => {
            markCopied(button);
            showToast(`Cupom copiado: ${coupon}`);
          })
          .catch(() => {
            showToast('Nao foi possivel copiar automaticamente.');
            prompt('Copie o cupom manualmente:', coupon);
          });
      }

      // Generic Copy
      function copyToClipboard(text, button) {
        copyText(text)
          .then(() => {
            markCopied(button);
            showToast('Comando copiado!');
          })
          .catch(() => {
            showToast('Nao foi possivel copiar automaticamente.');
            prompt('Copie o texto manualmente:', text);
          });
      }
    </script>
  </body>
</html>
